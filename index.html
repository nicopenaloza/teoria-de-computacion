<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Simulador de Máquina de Turing (Editor Visual)</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <main class="app" aria-labelledby="appTitle">
      <header class="app-header">
        <div class="header-row">
          <h1 id="appTitle">Laboratorio de Autómatas</h1>
          <button id="openDiagramConfig" type="button">Configurar diagrama</button>
        </div>
        <p>Simuladores de Máquina de Turing, AF (con minimización) y PDA.</p>
        <div class="sim-tabs" role="tablist" aria-label="Seleccionar simulador">
          <button id="tabTM" type="button" class="tab-btn active" data-view="tm" role="tab" aria-selected="true">MT</button>
          <button id="tabFA" type="button" class="tab-btn" data-view="fa" role="tab" aria-selected="false">AF</button>
          <button id="tabPDA" type="button" class="tab-btn" data-view="pda" role="tab" aria-selected="false">PDA</button>
        </div>
      </header>

      <section id="viewTM" class="sim-view active-view">
      <div class="workspace">
        <section class="panel editor" aria-labelledby="editorTitle">
          <div class="section-head">
            <h2 id="editorTitle">Diagrama</h2>
            <div class="actions compact">
              <button id="addState" type="button" title="Crear estado (N)">Estado</button>
              <button id="setStart" type="button" title="Marcar inicio (I)">Inicio</button>
              <button id="toggleAccept" type="button" title="Alternar aceptación (A)">Aceptación</button>
              <button id="deleteState" type="button" title="Eliminar estado (Supr)">Eliminar</button>
              <button id="loadExample" type="button">Ejemplo</button>
            </div>
          </div>

          <p id="graphInstructions" class="hint">
            Mouse: doble clic crea/edita, Shift+arrastrar crea flecha, arrastrar fondo desplaza el viewport. Teclado: N nuevo, I inicio, A aceptación, Supr eliminar, E editar transición, flechas mueve estado.
          </p>
          <p class="hint">Estado: <strong id="selectedState">(ninguno)</strong> · Flecha: <strong id="selectedTransition">(ninguna)</strong></p>

          <div
            id="stateGraph"
            class="state-graph"
            role="application"
            tabindex="0"
            aria-describedby="graphInstructions"
            aria-label="Editor de diagrama de estados"
          ></div>

          <div id="tapeArea" class="tape-cards" aria-live="polite"></div>

          <details class="advanced advanced-under-graph">
            <summary>Edición avanzada de transiciones</summary>
            <p class="hint">Formato: <code>e0 (>,>) -> (->, ->, e0)</code></p>

            <label for="transitionInput">
              Editor rápido (una transición)
              <input
                id="transitionInput"
                type="text"
                spellcheck="false"
                placeholder="e0 (>,>) -> (->, 1->, e1)"
              />
            </label>
            <div class="actions compact">
              <button id="saveTransition" type="button">Guardar</button>
              <button id="deleteTransition" type="button">Eliminar flecha</button>
              <button id="clearTransition" type="button">Limpiar</button>
            </div>

            <div class="table-wrap" aria-label="Tabla editable de transiciones">
              <table id="transitionsTable" class="transitions-table">
                <thead id="transitionsTableHead"></thead>
                <tbody id="transitionsTableBody"></tbody>
              </table>
            </div>
            <div class="actions compact">
              <button id="addTransitionRow" type="button">Agregar fila</button>
              <button id="deleteTransitionRow" type="button">Eliminar fila</button>
              <button id="applyTransitionTable" type="button">Aplicar tabla</button>
            </div>

            <label for="transitionsPreview">
              Texto crudo (opcional)
              <textarea id="transitionsPreview" rows="4" spellcheck="false"></textarea>
            </label>
          </details>
        </section>

        <aside class="side-column">
          <section class="panel config" aria-labelledby="configTitle">
            <h2 id="configTitle">Configuración</h2>

            <label for="tapeCount">
              Cantidad de cintas
              <input id="tapeCount" type="number" min="1" step="1" value="2" />
            </label>

            <div id="initialTapesEditor" class="tapes-config" aria-label="Editor de cintas iniciales"></div>
            <p class="hint">Solo la Cinta 1 es editable manualmente. Las demás son cintas infinitas (inician con <code>></code>).</p>

            <div class="actions compact">
              <button id="initialize" type="button">Inicializar</button>
              <button id="reset" type="button">Reiniciar</button>
            </div>
          </section>

          <section class="panel simulation" aria-labelledby="simTitle">
            <h2 id="simTitle">Simulación</h2>
            <div class="controls">
              <button id="step" type="button" disabled>Paso</button>
              <button id="run" type="button" disabled>Ejecutar</button>
              <button id="pause" type="button" disabled>Pausar</button>
              <label for="speed">Velocidad</label>
              <input id="speed" type="range" min="50" max="1000" step="50" value="300" />
              <output id="speedValue" for="speed">300 ms</output>
            </div>

            <div class="status" aria-live="polite">
              <p><strong>Estado:</strong> <span id="currentState">-</span></p>
              <p><strong>Paso:</strong> <span id="stepCount">0</span></p>
              <p><strong>Mensaje:</strong> <span id="message" role="status">Crea el diagrama e inicializa la máquina.</span></p>
            </div>
          </section>
        </aside>
      </div>

      <section class="panel legend" aria-labelledby="legendTitle">
        <h2 id="legendTitle">Leyenda de símbolos</h2>
        <p><strong>MT</strong></p>
        <p><code>#</code> = espacio vacío</p>
        <p><code>&gt;</code> = símbolo inicial de la cinta</p>
        <p><code>-&gt;</code> = mover cabezal a la derecha</p>
        <p><code>&lt;-</code> = mover cabezal a la izquierda</p>
        <p><code>valor-&gt;</code> = escribir <code>valor</code> y mover a la derecha</p>
        <p><code>valor&lt;-</code> = escribir <code>valor</code> y mover a la izquierda</p>
        <p><code>valor</code> = escribir <code>valor</code> y no mover</p>
        <p><code>eps</code> o <code>ε</code> = vacío (en MT escribe <code>#</code>)</p>
        <p><strong>AF</strong></p>
        <p><code>origen,simbolo -&gt; destino</code> = transición simple</p>
        <p><code>origen,simbolo -&gt; d1,d2</code> = no determinismo (varios destinos)</p>
        <p><code>eps</code> o <code>ε</code> = transición epsilon (sin consumir entrada)</p>
        <p><code>ab</code> = transición consumiendo dos símbolos consecutivos</p>
        <p><strong>PDA</strong></p>
        <p><code>estado,input,tope -&gt; siguiente,push</code> = regla de transición</p>
        <p><code>input = eps</code> = no consume entrada</p>
        <p><code>tope = eps</code> = no requiere símbolo en tope</p>
        <p><code>push = eps</code> = no apila (equivale a solo desapilar si aplica)</p>
      </section>
      </section>

      <section id="viewFA" class="sim-view">
        <div class="workspace">
          <section class="panel" aria-labelledby="faTitle">
            <h2 id="faTitle">Simulador AF</h2>
            <div class="section-head">
              <div class="actions compact">
                <button id="faAddState" type="button">Estado</button>
                <button id="faSetStart" type="button">Inicio</button>
                <button id="faToggleAccept" type="button">Aceptación</button>
                <button id="faDeleteState" type="button">Eliminar</button>
                <button id="faLoadGraphFromText" type="button">Desde texto</button>
              </div>
            </div>
            <p class="hint">AF seleccionado: <strong id="faSelectedState">(ninguno)</strong>. Shift+arrastrar crea transición, arrastrar fondo desplaza.</p>
            <div id="faGraph" class="state-graph" tabindex="0" aria-label="Editor gráfico AF"></div>
            <label for="faStates">Estados (coma)</label>
            <input id="faStates" type="text" value="q0,q1,q2" />
            <label for="faAlphabet">Alfabeto (coma)</label>
            <input id="faAlphabet" type="text" value="0,1" />
            <label for="faStartState">Estado inicial</label>
            <input id="faStartState" type="text" value="q0" />
            <label for="faAcceptStates">Estados de aceptación (coma)</label>
            <input id="faAcceptStates" type="text" value="q2" />
            <label for="faTransitions">
              Transiciones (<code>origen,etiqueta -> destino[,destino2]</code>; etiqueta puede ser <code>eps</code> o varios símbolos, ej. <code>ab</code>)
            </label>
            <textarea id="faTransitions" rows="10" spellcheck="false">q0,0 -> q0
q0,1 -> q1
q1,0 -> q2
q1,1 -> q1
q2,0 -> q2
q2,1 -> q2</textarea>
            <div class="actions">
              <button id="faLoadExample" type="button">Ejemplo</button>
              <button id="faEvaluate" type="button">Evaluar cadena</button>
              <button id="faMinimize" type="button">Minimizar</button>
            </div>
            <label for="faInputWord">Cadena de entrada</label>
            <input id="faInputWord" type="text" value="1010" />
            <div class="status" aria-live="polite">
              <p><strong>Resultado:</strong> <span id="faResult">-</span></p>
              <p><strong>Detalle:</strong> <span id="faMessage">Configura el autómata y evalúa.</span></p>
            </div>
            <label for="faMinimizedOutput">Salida minimizada</label>
            <textarea id="faMinimizedOutput" rows="10" spellcheck="false" readonly></textarea>
          </section>
        </div>
      </section>

      <section id="viewPDA" class="sim-view">
        <div class="workspace">
          <section class="panel" aria-labelledby="pdaTitle">
            <h2 id="pdaTitle">Simulador PDA</h2>
            <div class="section-head">
              <div class="actions compact">
                <button id="pdaAddState" type="button">Estado</button>
                <button id="pdaSetStart" type="button">Inicio</button>
                <button id="pdaToggleAccept" type="button">Aceptación</button>
                <button id="pdaDeleteState" type="button">Eliminar</button>
                <button id="pdaLoadGraphFromText" type="button">Desde texto</button>
              </div>
            </div>
            <p class="hint">PDA seleccionado: <strong id="pdaSelectedState">(ninguno)</strong>. Shift+arrastrar crea transición, arrastrar fondo desplaza.</p>
            <div id="pdaGraph" class="state-graph" tabindex="0" aria-label="Editor gráfico PDA"></div>
            <label for="pdaStates">Estados (coma)</label>
            <input id="pdaStates" type="text" value="q0,q1,qf" />
            <label for="pdaStartState">Estado inicial</label>
            <input id="pdaStartState" type="text" value="q0" />
            <label for="pdaAcceptStates">Estados de aceptación (coma)</label>
            <input id="pdaAcceptStates" type="text" value="qf" />
            <label for="pdaInitialStack">Símbolo inicial de pila</label>
            <input id="pdaInitialStack" type="text" value="Z" />
            <label for="pdaTransitions">
              Transiciones (<code>estado,input,top -> siguiente,push</code>; usa <code>eps</code> para vacío)
            </label>
            <textarea id="pdaTransitions" rows="10" spellcheck="false">q0,(,Z -> q0,(Z
q0,(,( -> q0,((
q0,),(( -> q0,eps
q0,eps,Z -> qf,Z</textarea>
            <label for="pdaInputWord">Cadena de entrada</label>
            <input id="pdaInputWord" type="text" value="(())()" />
            <div class="actions">
              <button id="pdaLoadExample" type="button">Ejemplo</button>
              <button id="pdaEvaluate" type="button">Evaluar</button>
            </div>
            <div class="status" aria-live="polite">
              <p><strong>Resultado:</strong> <span id="pdaResult">-</span></p>
              <p><strong>Detalle:</strong> <span id="pdaMessage">Configura el PDA y evalúa.</span></p>
            </div>
          </section>
        </div>
      </section>
    </main>

    <dialog id="diagramConfigDialog" class="config-dialog" aria-labelledby="diagramConfigTitle">
      <form method="dialog" class="config-dialog-body">
        <h2 id="diagramConfigTitle">Configuración de diagramas</h2>
        <label for="diagramMinDistance">
          Distancia mínima entre nodos (px)
          <input id="diagramMinDistance" type="number" min="68" step="1" value="90" />
        </label>
        <p class="hint">Cuando se crea o mueve un nodo, los nodos vecinos se desplazan para respetar esta distancia mínima.</p>
        <div class="actions">
          <button id="diagramConfigSave" type="button">Guardar</button>
          <button id="diagramConfigCancel" type="button">Cancelar</button>
        </div>
      </form>
    </dialog>

    <script src="app.js"></script>
  </body>
</html>
